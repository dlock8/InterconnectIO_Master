\hypertarget{scpi__i2c_8h}{}\doxysection{firmware/src/include/scpi\+\_\+i2c.h File Reference}
\label{scpi__i2c_8h}\index{firmware/src/include/scpi\_i2c.h@{firmware/src/include/scpi\_i2c.h}}


Header file defining constants and macros for the I2C communication.  


This graph shows which files directly or indirectly include this file\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{scpi__i2c_8h__dep__incl}
\end{center}
\end{figure}
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{scpi__i2c_8h_a909969901b432aa351897c87c869b45a}\label{scpi__i2c_8h_a909969901b432aa351897c87c869b45a}} 
\#define {\bfseries USER\+\_\+\+I2\+C\+\_\+\+SDA\+\_\+\+PIN}~6
\begin{DoxyCompactList}\small\item\em GPIO pin used for I2C SDA (Data line). \end{DoxyCompactList}\item 
\mbox{\Hypertarget{scpi__i2c_8h_a4caa86ff4d2aa41bead54eeec8dc93b2}\label{scpi__i2c_8h_a4caa86ff4d2aa41bead54eeec8dc93b2}} 
\#define {\bfseries USER\+\_\+\+I2\+C\+\_\+\+SCL\+\_\+\+PIN}~7
\begin{DoxyCompactList}\small\item\em GPIO pin used for I2C SCL (Clock line). \end{DoxyCompactList}\item 
\mbox{\Hypertarget{scpi__i2c_8h_aaec56e626f45401fa1b84e5973c74fc5}\label{scpi__i2c_8h_aaec56e626f45401fa1b84e5973c74fc5}} 
\#define {\bfseries DEF\+\_\+\+I2\+C\+\_\+\+USER}~i2c1
\begin{DoxyCompactList}\small\item\em i2c1 is the user communication channel to external \end{DoxyCompactList}\item 
\mbox{\Hypertarget{scpi__i2c_8h_aa624f7fec4cea656f43a3a1e8564ed8e}\label{scpi__i2c_8h_aa624f7fec4cea656f43a3a1e8564ed8e}} 
\#define {\bfseries DEF\+\_\+\+I2\+C\+\_\+\+BAUD}~1E5
\begin{DoxyCompactList}\small\item\em i2c baudrate is set at 100Khz by default \end{DoxyCompactList}\item 
\mbox{\Hypertarget{scpi__i2c_8h_ab7bf14e0711319dead16797ab6770cd6}\label{scpi__i2c_8h_ab7bf14e0711319dead16797ab6770cd6}} 
\#define {\bfseries DEF\+\_\+\+I2\+C\+\_\+\+ADDR}~0
\begin{DoxyCompactList}\small\item\em Default device Address. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{scpi__i2c_8h_af09c840cb71e0590be7bf8b935e4fb7e}\label{scpi__i2c_8h_af09c840cb71e0590be7bf8b935e4fb7e}} 
\#define {\bfseries DEF\+\_\+\+I2\+C\+\_\+\+DATABITS}~8
\begin{DoxyCompactList}\small\item\em i2c number of bits used for communication \end{DoxyCompactList}\item 
\mbox{\Hypertarget{scpi__i2c_8h_a3a7f86cdc0f64be0ea3ab2ee4b8b845b}\label{scpi__i2c_8h_a3a7f86cdc0f64be0ea3ab2ee4b8b845b}} 
\#define {\bfseries DEF\+\_\+\+I2\+C\+\_\+\+STATUS}~0
\begin{DoxyCompactList}\small\item\em spi is disable by default \end{DoxyCompactList}\item 
\#define \mbox{\hyperlink{scpi__i2c_8h_a64e439002936d3ec7cf456f30b96d8e3}{NOERR}}~0
\begin{DoxyCompactList}\small\item\em Error codes for I2C operations. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{scpi__i2c_8h_ade094dbd5c3b344ae06affa6486b7d38}\label{scpi__i2c_8h_ade094dbd5c3b344ae06affa6486b7d38}} 
\#define {\bfseries I2\+C\+\_\+\+GENERIC\+\_\+\+ERR}~-\/1
\begin{DoxyCompactList}\small\item\em Generic I2C error. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{scpi__i2c_8h_ae9dcda223f2ad1406434ac56d9e20249}\label{scpi__i2c_8h_ae9dcda223f2ad1406434ac56d9e20249}} 
\#define {\bfseries I2\+C\+\_\+\+TIMEOUT\+\_\+\+ERR}~-\/2
\begin{DoxyCompactList}\small\item\em I2C operation timed out. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{scpi__i2c_8h_aec898b798f9c54feaede8aca4f9692a5}\label{scpi__i2c_8h_aec898b798f9c54feaede8aca4f9692a5}} 
\#define {\bfseries I2\+C\+\_\+\+ADDRESS\+\_\+\+NACK}~-\/3
\begin{DoxyCompactList}\small\item\em No acknowledgment from the specified address. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{scpi__i2c_8h_aa3fc910095d1b423ba5d6d25c4c3568f}\label{scpi__i2c_8h_aa3fc910095d1b423ba5d6d25c4c3568f}} 
\#define {\bfseries I2\+C\+\_\+\+DATA\+\_\+\+NACK}~-\/4
\begin{DoxyCompactList}\small\item\em No acknowledgment for the data. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{scpi__i2c_8h_ae1a7222e3b927f8ba5c1342b98753121}\label{scpi__i2c_8h_ae1a7222e3b927f8ba5c1342b98753121}} 
\#define {\bfseries I2\+C\+\_\+\+BUS\+\_\+\+ERR}~-\/5
\begin{DoxyCompactList}\small\item\em Bus error encountered during I2C operation. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{scpi__i2c_8h_ab4ed9ef6064d1a95307c7f2ad9e618a7}\label{scpi__i2c_8h_ab4ed9ef6064d1a95307c7f2ad9e618a7}} 
\#define {\bfseries I2\+C\+\_\+\+MALLOC\+\_\+\+FAILURE}~52
\begin{DoxyCompactList}\small\item\em Memory allocation failure during I2C operation. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{scpi__i2c_8h_a6f252dac0f714f2dd94ee639f11a7e8d}\label{scpi__i2c_8h_a6f252dac0f714f2dd94ee639f11a7e8d}} 
\#define {\bfseries I2\+C\+\_\+\+NOT\+\_\+\+ENABLED}~53
\begin{DoxyCompactList}\small\item\em I2C interface is not enabled. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{scpi__i2c_8h_a639fdc51a3e50b4772d42b7793368cbc}\label{scpi__i2c_8h_a639fdc51a3e50b4772d42b7793368cbc}} 
void {\bfseries scpi\+\_\+i2c\+\_\+enable} (void)
\begin{DoxyCompactList}\small\item\em function to configure the parameters of the user I2C based on the data set on the I2C structure \end{DoxyCompactList}\item 
\mbox{\Hypertarget{scpi__i2c_8h_a1b2a1d8a0227b38df2c042ce8d5b8b67}\label{scpi__i2c_8h_a1b2a1d8a0227b38df2c042ce8d5b8b67}} 
void {\bfseries scpi\+\_\+i2c\+\_\+disable} (void)
\begin{DoxyCompactList}\small\item\em function to disable the user spi and configure pins reserved by SPI to normal GPIO, set as input. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{scpi__i2c_8h_af98e6fa769302f1e02f417cebba1ef6e}{scpi\+\_\+i2c\+\_\+status}} (void)
\begin{DoxyCompactList}\small\item\em Function who return if the user I2C is enabled or not. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{scpi__i2c_8h_a52fdbb304f278c99db17f76b9ce5a0b4}{scpi\+\_\+i2c\+\_\+set\+\_\+baudrate}} (uint32\+\_\+t speed)
\begin{DoxyCompactList}\small\item\em Function to update the baudrate speed on the structure, Baudrate will be updated with function spi enable. \end{DoxyCompactList}\item 
uint32\+\_\+t \mbox{\hyperlink{scpi__i2c_8h_a59a71878176cd7914a60d2bbd05a87ea}{scpi\+\_\+i2c\+\_\+get\+\_\+baudrate}} (void)
\begin{DoxyCompactList}\small\item\em function to return the actual baudrate \end{DoxyCompactList}\item 
uint8\+\_\+t \mbox{\hyperlink{scpi__i2c_8h_a5c1e152a4a59d650aefc3534e9e603fd}{scpi\+\_\+i2c\+\_\+set\+\_\+databits}} (uint32\+\_\+t num)
\begin{DoxyCompactList}\small\item\em Function to update the number of databits to be used. Necessary to determine if we doing communication using byte or word. \end{DoxyCompactList}\item 
uint32\+\_\+t \mbox{\hyperlink{scpi__i2c_8h_ad71bdb9d77d707f25de3a2f3ca6bbadf}{scpi\+\_\+i2c\+\_\+get\+\_\+databits}} (void)
\begin{DoxyCompactList}\small\item\em function to return the databits value saved on structure \end{DoxyCompactList}\item 
uint8\+\_\+t \mbox{\hyperlink{scpi__i2c_8h_a293c8d65eec0813d0d63223540e42b18}{scpi\+\_\+i2c\+\_\+set\+\_\+address}} (uint32\+\_\+t num)
\begin{DoxyCompactList}\small\item\em Function to update the device address to be used. \end{DoxyCompactList}\item 
uint32\+\_\+t \mbox{\hyperlink{scpi__i2c_8h_aa549b022300c94e6862d3d94ac107538}{scpi\+\_\+i2c\+\_\+get\+\_\+address}} (void)
\begin{DoxyCompactList}\small\item\em function to return the device address value saved on structure \end{DoxyCompactList}\item 
int8\+\_\+t \mbox{\hyperlink{scpi__i2c_8h_a76df3108d1a2c822fb1d43090b4274ca}{scpi\+\_\+i2c\+\_\+wri\+\_\+read\+\_\+data}} (uint8\+\_\+t $\ast$wdata, uint8\+\_\+t wlen, uint8\+\_\+t $\ast$rdata, uint8\+\_\+t rlen, bool $\ast$wflag)
\begin{DoxyCompactList}\small\item\em Main function called by SCPI command to send or receive data on I2C port. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Header file defining constants and macros for the I2C communication. 

\begin{DoxyAuthor}{Author}
Daniel Lockhead 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
2024
\end{DoxyDate}
\begin{DoxyCopyright}{Copyright}
Copyright (c) 2024, D.\+Lockhead. All rights reserved.
\end{DoxyCopyright}
This software is licensed under the BSD 3-\/Clause License. See the LICENSE file for more details. 

\doxysubsection{Macro Definition Documentation}
\mbox{\Hypertarget{scpi__i2c_8h_a64e439002936d3ec7cf456f30b96d8e3}\label{scpi__i2c_8h_a64e439002936d3ec7cf456f30b96d8e3}} 
\index{scpi\_i2c.h@{scpi\_i2c.h}!NOERR@{NOERR}}
\index{NOERR@{NOERR}!scpi\_i2c.h@{scpi\_i2c.h}}
\doxysubsubsection{\texorpdfstring{NOERR}{NOERR}}
{\footnotesize\ttfamily \#define NOERR~0}



Error codes for I2C operations. 

No error. 

\doxysubsection{Function Documentation}
\mbox{\Hypertarget{scpi__i2c_8h_aa549b022300c94e6862d3d94ac107538}\label{scpi__i2c_8h_aa549b022300c94e6862d3d94ac107538}} 
\index{scpi\_i2c.h@{scpi\_i2c.h}!scpi\_i2c\_get\_address@{scpi\_i2c\_get\_address}}
\index{scpi\_i2c\_get\_address@{scpi\_i2c\_get\_address}!scpi\_i2c.h@{scpi\_i2c.h}}
\doxysubsubsection{\texorpdfstring{scpi\_i2c\_get\_address()}{scpi\_i2c\_get\_address()}}
{\footnotesize\ttfamily uint32\+\_\+t scpi\+\_\+i2c\+\_\+get\+\_\+address (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



function to return the device address value saved on structure 

\begin{DoxyReturn}{Returns}
uint32\+\_\+t Device address 
\end{DoxyReturn}
\mbox{\Hypertarget{scpi__i2c_8h_a59a71878176cd7914a60d2bbd05a87ea}\label{scpi__i2c_8h_a59a71878176cd7914a60d2bbd05a87ea}} 
\index{scpi\_i2c.h@{scpi\_i2c.h}!scpi\_i2c\_get\_baudrate@{scpi\_i2c\_get\_baudrate}}
\index{scpi\_i2c\_get\_baudrate@{scpi\_i2c\_get\_baudrate}!scpi\_i2c.h@{scpi\_i2c.h}}
\doxysubsubsection{\texorpdfstring{scpi\_i2c\_get\_baudrate()}{scpi\_i2c\_get\_baudrate()}}
{\footnotesize\ttfamily uint32\+\_\+t scpi\+\_\+i2c\+\_\+get\+\_\+baudrate (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



function to return the actual baudrate 

\begin{DoxyReturn}{Returns}
uint32\+\_\+t baudrate 
\end{DoxyReturn}
\mbox{\Hypertarget{scpi__i2c_8h_ad71bdb9d77d707f25de3a2f3ca6bbadf}\label{scpi__i2c_8h_ad71bdb9d77d707f25de3a2f3ca6bbadf}} 
\index{scpi\_i2c.h@{scpi\_i2c.h}!scpi\_i2c\_get\_databits@{scpi\_i2c\_get\_databits}}
\index{scpi\_i2c\_get\_databits@{scpi\_i2c\_get\_databits}!scpi\_i2c.h@{scpi\_i2c.h}}
\doxysubsubsection{\texorpdfstring{scpi\_i2c\_get\_databits()}{scpi\_i2c\_get\_databits()}}
{\footnotesize\ttfamily uint32\+\_\+t scpi\+\_\+i2c\+\_\+get\+\_\+databits (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



function to return the databits value saved on structure 

\begin{DoxyReturn}{Returns}
uint32\+\_\+t databits 
\end{DoxyReturn}
\mbox{\Hypertarget{scpi__i2c_8h_a293c8d65eec0813d0d63223540e42b18}\label{scpi__i2c_8h_a293c8d65eec0813d0d63223540e42b18}} 
\index{scpi\_i2c.h@{scpi\_i2c.h}!scpi\_i2c\_set\_address@{scpi\_i2c\_set\_address}}
\index{scpi\_i2c\_set\_address@{scpi\_i2c\_set\_address}!scpi\_i2c.h@{scpi\_i2c.h}}
\doxysubsubsection{\texorpdfstring{scpi\_i2c\_set\_address()}{scpi\_i2c\_set\_address()}}
{\footnotesize\ttfamily uint8\+\_\+t scpi\+\_\+i2c\+\_\+set\+\_\+address (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{num }\end{DoxyParamCaption})}



Function to update the device address to be used. 


\begin{DoxyParams}{Parameters}
{\em num} & Device Address \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{scpi__i2c_8h_a52fdbb304f278c99db17f76b9ce5a0b4}\label{scpi__i2c_8h_a52fdbb304f278c99db17f76b9ce5a0b4}} 
\index{scpi\_i2c.h@{scpi\_i2c.h}!scpi\_i2c\_set\_baudrate@{scpi\_i2c\_set\_baudrate}}
\index{scpi\_i2c\_set\_baudrate@{scpi\_i2c\_set\_baudrate}!scpi\_i2c.h@{scpi\_i2c.h}}
\doxysubsubsection{\texorpdfstring{scpi\_i2c\_set\_baudrate()}{scpi\_i2c\_set\_baudrate()}}
{\footnotesize\ttfamily void scpi\+\_\+i2c\+\_\+set\+\_\+baudrate (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{speed }\end{DoxyParamCaption})}



Function to update the baudrate speed on the structure, Baudrate will be updated with function spi enable. 


\begin{DoxyParams}{Parameters}
{\em speed} & Baudrate to save on structure \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{scpi__i2c_8h_a5c1e152a4a59d650aefc3534e9e603fd}\label{scpi__i2c_8h_a5c1e152a4a59d650aefc3534e9e603fd}} 
\index{scpi\_i2c.h@{scpi\_i2c.h}!scpi\_i2c\_set\_databits@{scpi\_i2c\_set\_databits}}
\index{scpi\_i2c\_set\_databits@{scpi\_i2c\_set\_databits}!scpi\_i2c.h@{scpi\_i2c.h}}
\doxysubsubsection{\texorpdfstring{scpi\_i2c\_set\_databits()}{scpi\_i2c\_set\_databits()}}
{\footnotesize\ttfamily uint8\+\_\+t scpi\+\_\+i2c\+\_\+set\+\_\+databits (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{num }\end{DoxyParamCaption})}



Function to update the number of databits to be used. Necessary to determine if we doing communication using byte or word. 


\begin{DoxyParams}{Parameters}
{\em num} & Databits to write \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{scpi__i2c_8h_af98e6fa769302f1e02f417cebba1ef6e}\label{scpi__i2c_8h_af98e6fa769302f1e02f417cebba1ef6e}} 
\index{scpi\_i2c.h@{scpi\_i2c.h}!scpi\_i2c\_status@{scpi\_i2c\_status}}
\index{scpi\_i2c\_status@{scpi\_i2c\_status}!scpi\_i2c.h@{scpi\_i2c.h}}
\doxysubsubsection{\texorpdfstring{scpi\_i2c\_status()}{scpi\_i2c\_status()}}
{\footnotesize\ttfamily bool scpi\+\_\+i2c\+\_\+status (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Function who return if the user I2C is enabled or not. 

\begin{DoxyReturn}{Returns}
True if I2C is enabled 
\end{DoxyReturn}
\mbox{\Hypertarget{scpi__i2c_8h_a76df3108d1a2c822fb1d43090b4274ca}\label{scpi__i2c_8h_a76df3108d1a2c822fb1d43090b4274ca}} 
\index{scpi\_i2c.h@{scpi\_i2c.h}!scpi\_i2c\_wri\_read\_data@{scpi\_i2c\_wri\_read\_data}}
\index{scpi\_i2c\_wri\_read\_data@{scpi\_i2c\_wri\_read\_data}!scpi\_i2c.h@{scpi\_i2c.h}}
\doxysubsubsection{\texorpdfstring{scpi\_i2c\_wri\_read\_data()}{scpi\_i2c\_wri\_read\_data()}}
{\footnotesize\ttfamily int8\+\_\+t scpi\+\_\+i2c\+\_\+wri\+\_\+read\+\_\+data (\begin{DoxyParamCaption}\item[{uint8\+\_\+t $\ast$}]{wdata,  }\item[{uint8\+\_\+t}]{wlen,  }\item[{uint8\+\_\+t $\ast$}]{rdata,  }\item[{uint8\+\_\+t}]{rlen,  }\item[{bool $\ast$}]{wflag }\end{DoxyParamCaption})}



Main function called by SCPI command to send or receive data on I2C port. 

This function handles I2C communication by writing data to the I2C bus and reading the response back. It supports both byte and word transfers depending on the flag.


\begin{DoxyParams}{Parameters}
{\em wdata} & Pointer to the data array to be written to the I2C device. \\
\hline
{\em wlen} & Length of the write array (number of bytes/words to write). \\
\hline
{\em rdata} & Pointer to the array where the received data will be stored. \\
\hline
{\em rlen} & Length of the read array (number of bytes/words expected to read). \\
\hline
{\em wflag} & Flag to specify data size\+: {\ttfamily true} for word transfers, {\ttfamily false} for byte transfers.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
int8\+\_\+t Error code. Returns a negative value if an error occurs. 
\end{DoxyReturn}
\texorpdfstring{$<$}{<} set flag to return the size of data (byte or word)